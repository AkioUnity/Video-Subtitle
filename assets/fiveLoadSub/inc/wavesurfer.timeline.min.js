!function(e,t){"function"==typeof define&&define.amd?define(["wavesurfer"],t):e.WaveSurfer.Timeline=t(e.WaveSurfer)}(this,function(e){"use strict";return e.Timeline={init:function(e){this.params=e;var t=this.wavesurfer=e.wavesurfer;if(!this.wavesurfer)throw Error("No WaveSurfer intance provided");var i=this.drawer=this.wavesurfer.drawer;if(this.container="string"==typeof e.container?document.querySelector(e.container):e.container,!this.container)throw Error("No container for WaveSurfer timeline");this.width=i.width,this.height=this.params.height||20,this.notchPercentHeight=this.params.notchPercentHeight||90,this.primaryColor=this.params.primaryColor||"#FFF",this.secondaryColor=this.params.secondaryColor||"#FFF",this.primaryFontColor=this.params.primaryFontColor||"#FFF",this.secondaryFontColor=this.params.secondaryFontColor||"#FFF",this.fontFamily=this.params.fontFamily||"Arial",this.fontSize=this.params.fontSize||10,this.createWrapper(),this.createCanvas(),this.render(),t.drawer.wrapper.onscroll=this.updateScroll.bind(this),t.on("redraw",this.render.bind(this)),t.on("destroy",this.destroy.bind(this))},destroy:function(){this.unAll(),this.wrapper&&this.wrapper.parentNode&&(this.wrapper.parentNode.removeChild(this.wrapper),this.wrapper=null)},createWrapper:function(){var e=this.container.querySelector("timeline");e&&this.container.removeChild(e);var t=this.wavesurfer.params;this.wrapper=this.container.appendChild(document.createElement("timeline")),this.drawer.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.height+"px"}),(t.fillParent||t.scrollParent)&&this.drawer.style(this.wrapper,{width:"100%",overflowX:"hidden",overflowY:"hidden"});var i=this;this.wrapper.addEventListener("click",function(e){e.preventDefault();var t="offsetX"in e?e.offsetX:e.layerX;i.fireEvent("click",t/i.wrapper.scrollWidth||0)})},createCanvas:function(){var e=this.canvas=this.wrapper.appendChild(document.createElement("canvas"));this.timeCc=e.getContext("2d"),this.wavesurfer.drawer.style(e,{position:"absolute",zIndex:4})},render:function(){this.updateCanvasStyle(),this.drawTimeCanvas()},updateCanvasStyle:function(){var e=this.drawer.wrapper.scrollWidth;this.canvas.width=e*this.wavesurfer.params.pixelRatio,this.canvas.height=this.height*this.wavesurfer.params.pixelRatio,this.canvas.style.width=e+"px",this.canvas.style.height=this.height+"px"},drawTimeCanvas:function(){var e=this.wavesurfer.backend,t=this.wavesurfer.params,i=e.getDuration();if(t.fillParent&&!t.scrollParent)var r=this.drawer.getWidth();else r=this.drawer.wrapper.scrollWidth*t.pixelRatio;var a=r/i;if(i>0){var s=0,n=0,h=parseInt(i,10)+1,o=function(e){if(e/60>1){var t=parseInt(e/60),e=parseInt(e%60);return e=10>e?"0"+e:e,""+t+":"+e}return e};if(1*a>=25)var l=1,c=10,p=5;else if(5*a>=25)var l=5,c=6,p=2;else if(15*a>=25)var l=15,c=4,p=2;else var l=60,c=4,p=2;for(var f=this.height-4,d=this.height*(this.notchPercentHeight/100)-4,v=this.fontSize*t.pixelRatio,m=0;h/l>m;m++)m%c==0?(this.timeCc.fillStyle=this.primaryColor,this.timeCc.fillRect(s,0,1,f),this.timeCc.font=v+"px "+this.fontFamily,this.timeCc.fillStyle=this.primaryFontColor,this.timeCc.fillText(o(n),s+5,f)):m%p==0?(this.timeCc.fillStyle=this.secondaryColor,this.timeCc.fillRect(s,0,1,f),this.timeCc.font=v+"px "+this.fontFamily,this.timeCc.fillStyle=this.secondaryFontColor,this.timeCc.fillText(o(n),s+5,f)):(this.timeCc.fillStyle=this.secondaryColor,this.timeCc.fillRect(s,0,1,d)),n+=l,s+=a*l}},updateScroll:function(){this.wrapper.scrollLeft=this.drawer.wrapper.scrollLeft}},e.util.extend(e.Timeline,e.Observer),e.Timeline});